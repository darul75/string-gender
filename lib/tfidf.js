/*! 
* @license string-gender - v0.0.1
* (c) 2014 Julien VALERY https://github.com/darul75/string-gender
* License: MIT 
*/
function buildDocument(a,b){var c;if("string"==typeof a)a=tokenizer.tokenize(a.toLowerCase()),c=!0;else if(!_.isArray(a))return a;return a.reduce(function(a,b){return"function"==typeof a[b]&&(a[b]=0),(!c||stopwords.indexOf(b)<0)&&(a[b]=a[b]?a[b]+1:1),a},{__key:b})}function tf(a,b){return b[a]?b[a]:0}function documentHasTerm(a,b){return b[a]&&b[a]>0}function TfIdf(a){this.documents=a?a.documents:[],this._idfCache={}}var _=require("underscore")._,Tokenizer=require("../node_modules/natural/lib/natural/tokenizers/regexp_tokenizer.js").RegexpTokenizer,tokenizer=new Tokenizer({pattern:/(\s)+/}),stopwords=require("../node_modules/natural/lib/natural/util/stopwords.js").words,fs=require("fs");module.exports=TfIdf,TfIdf.tf=tf,TfIdf.prototype.idf=function(a,b){if(this._idfCache[a]&&this._idfCache.hasOwnProperty(a)&&b!==!0)return this._idfCache[a];var c=this.documents.reduce(function(b,c){return b+(documentHasTerm(a,c)?1:0)},0),d=Math.log(this.documents.length/c);return this._idfCache[a]=d,d},TfIdf.prototype.addDocument=function(a,b,c){if(this.documents.push(buildDocument(a,b)),c===!0)for(var d in this._idfCache)this.idf(d,!0);else this._idfCache={}},TfIdf.prototype.addFileSync=function(a,b,c,d){b||(b="UTF-8");var e=fs.readFileSync(a,"UTF-8");if(this.documents.push(buildDocument(e,c)),d===!0)for(var f in this._idfCache)this.idf(f,!0);else this._idfCache={}},TfIdf.prototype.tfidf=function(a,b){var c=this;return _.isArray(a)||(a=tokenizer.tokenize(a.toString().toLowerCase())),a.reduce(function(a,d){return a+tf(d,c.documents[b])*c.idf(d)},0)},TfIdf.prototype.listTerms=function(a){var b=[];for(var c in this.documents[a])"__key"!=c&&b.push({term:c,tfidf:this.tfidf(c,a)});return b.sort(function(a,b){return b.tfidf-a.tfidf})},TfIdf.prototype.tfidfs=function(a,b){for(var c=new Array(this.documents.length),d=0;d<this.documents.length;d++)c[d]=this.tfidf(a,d),b&&b(d,c[d],this.documents[d].__key);return c};